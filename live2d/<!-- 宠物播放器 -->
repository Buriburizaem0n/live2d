<!-- 宠物播放器 -->

<script src="https://cdn.jsdelivr.net/npm/live2dcubismcore@1.0.2/live2dcubismcore.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/pixi-live2d-display/dist/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/pixi.js@7.x/dist/pixi.min.js"></script>

<script>
const live2d_path = "https://www.luoyangdonghui.de/wp-content/uploads/live2d_test16/live2d/";
</script>

<meting-js server="netease" type="playlist" id="2142063878" theme="#339981" fixed="true" preload="none" autoplay="false" loop="all" volume="0.3" order="random" mutex="true"></meting-js>;
<script>
// 封装异步加载资源的方法
function loadExternalResource(url, type, scriptType = null) {
    return new Promise((resolve, reject) => {
        let tag;

        if (type === "css") {
            tag = document.createElement("link");
            tag.rel = "stylesheet";
            tag.href = url;
            tag.type = "text/css";  // 添加 CSS 类型
        } else if (type === "js") {
            tag = document.createElement("script");
            tag.src = url;

            // 如果 scriptType 存在，则为 <script> 添加 type 属性
            if (scriptType) {
                tag.type = scriptType;  // 如 "module" 或 "text/javascript"
            }
        }

        tag.onload = () => resolve(url);
        tag.onerror = () => reject(new Error(`Failed to load resource: ${url}`));

        // 将标签追加到 <head> 中
        document.head.appendChild(tag);
    });
}

// 手机和电脑都加载的音乐播放器相关资源
Promise.all([
    loadExternalResource("https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css", "css"),
    loadExternalResource("https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js", "js"),
]).then(() => {
    loadExternalResource("https://cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js", "js");
});

ap = null;
Object.defineProperty(document.querySelector('meting-js'), "aplayer", {
    set: function(aplayer) {
        ap = aplayer;
        ap_init();
        initWidget();
    }
});

// 只有电脑加载Live2D模块
if (screen.width >= 768) {
    Promise.all([
        loadExternalResource(live2d_path + "waifu.css", "css"),
        loadExternalResource(live2d_path + "live2d.min.js", "js"),
        loadExternalResource(live2d_path + "waifu-tips.js", "js", "module")
    ]);
}

</script>
